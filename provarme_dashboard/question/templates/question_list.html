{% extends "base.html" %}
{% load static %}
{% block styles %}
	<link type="text/css" rel="stylesheet" href="{% static 'assets/css/theme-default/libs/DataTables/jquery.dataTables.css' %}" />
	<link type="text/css" rel="stylesheet" href="{% static 'assets/vendors/sweetalert/sweetalert.css' %}" />
{% endblock styles %}
{% block content %}
	<!-- BEGIN CONTENT-->
	<div id="content">
		<section class="style-default-bright">
			<div class="section-header ">
				<ol class="breadcrumb">
					<li><a href="{% url 'dashboard' %}">Dashboard</a></li>
					<li class="active">Banco de Questões</li>
				</ol>
			</div>
			<div class="section-header">
				<h2 class="text-primary">Banco de questões</h2>
				<span class="pull-right"><a href="{% url 'question_add' %}" class="btn ink-reaction btn-primary"><i class="fa fa-plus"></i> Nova Questão</a></span>
				<span class="pull-right" style="padding-right: 8px;"><a href="{% url 'tag_list' %}" class="btn ink-reaction btn-primary"><i class="fa fa-tag"></i> Tags</a></span>
				<span class="pull-right" style="padding-right: 8px;"><a href="{% url 'category_list' %}" class="btn ink-reaction btn-primary"><i class="fa fa-bars"></i> Categorias</a></span>
			</div>
			<div class="section-body">

				<!-- BEGIN DATATABLE 1 -->
				<div class="row">
					<div class="col-md-8">
						<article class="margin-bottom-xxl">
							<p class="lead">
								As questões do Banco de Questões podem ser utilizadas pelo administrador para criar provas e pelos usuários para criarem seus simulados.
							</p>
						</article>
					</div><!--end .col -->
				</div><!--end .row -->
				<div class="row">
					<div class="col-lg-12">
						<div class="table-responsive">
							<table id="questions" class="table table-striped table-hover">
								<thead>
									<tr>
										<th>Enunciado</th>
										<th>Categorias</th>
										<th>Tags</th>
										<th class="no-sort">Ações</th>
									</tr>
								</thead>
								<tbody>
									{% for question in questions %}
										<tr>
											<td>{{ question.wording|safe|truncatechars_html:"80" }}</td>
                                            <td>
                                             {% for category in question.categories.all  %}
                                             <span class="label label-success">
                                             {{ category }}
                                             </span>
                                             {% endfor  %}
                                            </td>
											<td>
												{% for tag in question.tags.all %}
													<span class="label label-info">
														{{ tag }}
													</span>
												{% endfor %}
											</td>
											<td>
												<a href="{% url 'question_edit' question.id %}" class="btn btn-flat" data-toggle="tooltip" data-title="Editar Questão"><i class="fa fa-edit"></i></a>
												<a href="#" class="btn btn-flat delete-question" data-toggle="tooltip" data-title="Excluir Questão" data-url="{% url 'question_delete' question.id %}"><i class="fa fa-trash"></i></a>
											</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div><!--end .table-responsive -->
					</div><!--end .col -->
				</div><!--end .row -->
				<!-- END DATATABLE 1 -->

			</div><!--end .section-body -->
		</section>
	</div><!--end #content-->
	<!-- END CONTENT -->
{% endblock content %}
{% block scripts %}
	<script src="{% static 'assets/js/libs/DataTables/jquery.dataTables.min.js' %}"></script>
	<script src="{% static 'assets/vendors/sweetalert/sweetalert.min.js' %}"></script>
	<!-- <script src="{% static 'assets/js/libs/DataTables/extensions/ColVis/js/dataTables.colVis.min.js' %}"></script>
	<script src="{% static 'assets/js/libs/DataTables/extensions/TableTools/js/dataTables.tableTools.min.js' %}"></script>
	<script src="{% static 'assets/js/core/demo/DemoTableDynamic.js' %}"></script> -->
	<script>
		$(document).ready(function () {
			/*$("#questions").DataTable({
				"columnDefs": [{
					"targets": 'no-sort',
					"orderable": false,
				}]
			});*/
            $('#questions').DataTable({
                columnDefs: [{
                    targets:1,
                    render: function( data, type, row  ){
                        return data.length > 20 ?
                            data.substr(0, 100) +  '...':
                            data;
                    }
                }]
            });

			$("#questions").on("click", ".delete-question", function () {
				var url = $(this).attr("data-url");
				deleteQuestion(url);
			});

			function deleteQuestion(url) {
				swal({
					title: "Tem certeza?",
					text: "Você irá excluir essa questão e tudo relacionado a ela será apagado!",
					type: "warning",
					showCancelButton: true,
					cancelButtonText: "Cancelar",
					confirmButtonColor: "#DD6B55",
					confirmButtonText: "Sim, excluir!",
					closeOnConfirm: false
				},
				function(isConfirm){
					if (isConfirm) {
						window.location.href = url;
					}
				});
			};
		});
	</script>
{% endblock scripts %}
